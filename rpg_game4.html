<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web RPG Engine</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DotGothic16&display=swap" rel="stylesheet">

    <style>
        /* --- CSS „Çπ„Çø„Ç§„É´Ë®≠ÂÆö --- */
        :root {
            --bg-color: #202020;
            --box-bg: #000000;
            --border-color: #ffffff;
            --text-color: #ffffff;
            --accent-color: #ffd700;
        }

        body {
            margin: 0;
            padding: 0;
            background-color: #111;
            font-family: 'DotGothic16', sans-serif;
            color: var(--text-color);
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            user-select: none; /* „ÉÜ„Ç≠„Çπ„ÉàÈÅ∏ÊäûÁ¶ÅÊ≠¢ */
        }

        #game-container {
            width: 800px;
            height: 600px;
            background: linear-gradient(to bottom, #0f2027, #203a43, #2c5364);
            position: relative;
            border: 4px solid var(--border-color);
            box-shadow: 0 0 20px rgba(0,0,0,0.8);
            overflow: hidden;
        }

        #scene-display {
            width: 100%;
            height: 70%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 100px;
        }

        #message-box {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 90%;
            height: 140px;
            background-color: rgba(0, 0, 0, 0.85);
            border: 3px solid var(--border-color);
            border-radius: 4px;
            padding: 20px;
            box-sizing: border-box;
            font-size: 24px;
            line-height: 1.6;
            cursor: pointer;
        }

        .cursor-blink {
            display: inline-block;
            animation: blink 1s step-end infinite;
            color: var(--accent-color);
            margin-left: 5px;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0; }
        }

        #choices-container {
            position: absolute;
            top: 40%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: flex;
            flex-direction: column;
            gap: 15px;
            z-index: 10;
        }

        .choice-btn {
            background-color: rgba(0, 0, 0, 0.9);
            color: var(--text-color);
            border: 2px solid var(--border-color);
            padding: 15px 40px;
            font-size: 20px;
            font-family: 'DotGothic16', sans-serif;
            cursor: pointer;
            transition: all 0.2s;
            text-align: left;
            min-width: 300px;
        }

        .choice-btn:hover {
            background-color: var(--border-color);
            color: var(--box-bg);
            transform: scale(1.05);
        }

        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>

    <div id="game-container">
        <div id="scene-display">üè∞</div>
        <div id="choices-container" class="hidden"></div>
        <div id="message-box" onclick="handleMessageClick()">
            <span id="text-content"></span>
            <span id="next-cursor" class="hidden">‚ñº</span>
        </div>
    </div>

    <script>
        // --- „Ç∑„Éä„É™„Ç™„Éá„Éº„Çø ---
        const scenario = {
            "start": {
                text: "„ÅÇ„Å™„Åü„ÅØ„ÄÄÂè§Âüé„ÅÆÂâç„Å´„ÄÄÁ´ã„Å£„Å¶„ÅÑ„Çã„ÄÇ\nÈáçÂéö„Å™Êââ„Åå„ÄÄÈñâ„Åñ„Åï„Çå„Å¶„ÅÑ„Çã„Çà„ÅÜ„Å†„ÄÇ",
                choices: [
                    { text: "Êââ„Çí„Éé„ÉÉ„ÇØ„Åô„Çã", next: "scene_knock" },
                    { text: "Âë®Âõ≤„ÇíË™ø„Åπ„Çã", next: "scene_search" }
                ]
            },
            "scene_knock": {
                text: "„Ç≥„É≥„Ç≥„É≥‚Ä¶‚Ä¶„ÄÇ\n\n‰∏≠„Åã„Çâ„ÄÄË™∞„Åã„ÅÆÊ∞óÈÖç„Åå„Åô„Çã„ÄÇ",
                choices: [
                    { text: "„ÄåË™∞„Åã„ÅÑ„Åæ„Åô„ÅãÔºü„Äç„Å®Âè´„Å∂", next: "scene_shout" },
                    { text: "ÈÄÉ„ÅíÂá∫„Åô", next: "scene_run" }
                ]
            },
            "scene_search": {
                text: "Ë∂≥ÂÖÉ„Å´„ÄÄÈçµ„ÅåËêΩ„Å°„Å¶„ÅÑ„ÅüÔºÅ\n„Åì„Çå„ÅßÊââ„Åå„ÄÄÈñã„Åè„Åã„ÇÇ„Åó„Çå„Å™„ÅÑ„ÄÇ",
                choices: [
                    { text: "Èçµ„Çí‰Ωø„Å£„Å¶Èñã„Åë„Çã", next: "scene_open" },
                    { text: "Ë¶ã„Å™„Åã„Å£„Åü„Åì„Å®„Å´„Åó„Å¶Â∏∞„Çã", next: "scene_run" }
                ]
            },
            "scene_shout": {
                text: "„Äå„ÅÜ„Çã„Åï„ÅÑ„ÅûÔºÅ„Äç\nÂè§Âüé„Åã„ÇâÊÄí„Å£„ÅüË°õÂÖµ„Åå„ÄÄÈ£õ„Å≥Âá∫„Åó„Å¶„Åç„ÅüÔºÅ",
                choices: [
                    { text: "Êñ¨„Çä„Åã„Åã„Çã", next: "scene_slash" },
                    { text: "Ë¨ù„Å£„Å¶„Åì„ÅÆÂ†¥„ÇíÂéª„Çã", next: "scene_goodbye" }
                ]
            },
            "scene_run": {
                text: "„ÅÇ„Å™„Åü„ÅØ„ÄÄÂÖ®Âäõ„Åß„ÄÄÈÄÉ„ÅíÂá∫„Åó„Åü„ÄÇ\nÂêõÂ≠êÂç±„ÅÜ„Åç„Å´ËøëÂØÑ„Çâ„Åö„ÄÅ„Å†„ÄÇ\n\n(GAME OVER - „É™„É≠„Éº„Éâ„Åó„Å¶ÂÜçÊåëÊà¶)",
                choices: []
            },
            "scene_open": {
                text: "„Ç¨„ÉÅ„É£„É™„ÄÇ\nÊââ„ÅåÈñã„ÅÑ„Åü„ÄÇ\n„ÅÇ„Å™„Åü„ÅÆÂÜíÈô∫„ÅØ„ÄÄ„Åì„Åì„Åã„ÇâÂßã„Åæ„Çã‚Ä¶‚Ä¶ÔºÅ\n\n(TO BE CONTINUED)",
                choices: []
            },
            "scene_slash": {
                text: "„ÅÇ„Å™„Åü„ÅØ„ÄÄË°õÂÖµ„Å´Êñ¨„Çä„Åã„Åã„Å£„Åü„ÄÇ\n„Åó„Åã„Åó„ÄÅË≤†„Åë„Åü„ÄÅ„ÅÇ„Å™„Åü„ÅÆÊóÖ„ÅØÁµÇ„Çè„Å£„Å¶„Åó„Åæ„Å£„ÅüÔºÅ\n\n(GAME OVER - „É™„É≠„Éº„Éâ„Åó„Å¶ÂÜçÊåëÊà¶)",
                choices: []
            },
            "scene_goodbye": {
                text: "„ÅÇ„Å™„Åü„ÅØ„ÄÄÂÖ®Âäõ„Åß„ÄÄË¨ù„Å£„Åü„ÄÇ\n60¬∞„Å´Âèä„Å∂Âúü‰∏ãÂ∫ß„Å´„Çà„Å£„Å¶Ë®±„Åï„Çå„Åü„ÄÇ\n\n(END - „É™„É≠„Éº„Éâ„Åó„Å¶ÂÜçÊåëÊà¶)",
                choices: []
            }
        };

        // --- Â§âÊï∞ÂÆöÁæ© ---
        let currentSceneId = "start";
        let isTyping = false;
        let typingInterval;
        let fullText = "";
        
        const textElement = document.getElementById("text-content");
        const cursorElement = document.getElementById("next-cursor");
        const choicesContainer = document.getElementById("choices-container");
        const sceneDisplay = document.getElementById("scene-display");

        // --- „Ç≤„Éº„É†ÈñãÂßã ---
        window.onload = () => {
            loadScene("start");
        };

        // --- „Ç∑„Éä„É™„Ç™Ë™≠„ÅøËæº„ÅøÈñ¢Êï∞ ---
        function loadScene(sceneId) {
            currentSceneId = sceneId;
            const sceneData = scenario[sceneId];

            textElement.innerHTML = "";
            cursorElement.classList.add("hidden");
            choicesContainer.classList.add("hidden");
            choicesContainer.innerHTML = ""; 

            fullText = sceneData.text;
            startTypewriter(fullText, () => {
                showChoices(sceneData.choices);
            });
        }

        // --- „Çø„Ç§„Éó„É©„Ç§„Çø„ÉºÊºîÂá∫Èñ¢Êï∞ ---
        function startTypewriter(text, callback) {
            isTyping = true;
            let index = 0;
            textElement.innerHTML = "";

            typingInterval = setInterval(() => {
                if (index < text.length) {
                    const char = text.charAt(index);
                    if (char === "\n") {
                        textElement.innerHTML += "<br>";
                    } else {
                        textElement.innerHTML += char;
                    }
                    index++;
                } else {
                    finishTyping(callback);
                }
            }, 50);
        }

        // --- „Çø„Ç§„Éî„É≥„Ç∞Âº∑Âà∂ÁµÇ‰∫ÜÔºà„Çπ„Ç≠„ÉÉ„ÉóÔºâ ---
        function finishTyping(callback) {
            clearInterval(typingInterval);
            textElement.innerHTML = fullText.replace(/\n/g, "<br>");
            isTyping = false;

            if (scenario[currentSceneId].choices && scenario[currentSceneId].choices.length > 0) {
                cursorElement.classList.remove("hidden");
                cursorElement.classList.add("cursor-blink");
            }

            if (callback) callback();
        }

        // --- „ÇØ„É™„ÉÉ„ÇØÊôÇ„ÅÆÊåôÂãïÂà∂Âæ° ---
        function handleMessageClick() {
            if (isTyping) {
                const sceneData = scenario[currentSceneId];
                finishTyping(() => {
                    showChoices(sceneData.choices);
                });
            }
        }

        // --- ÈÅ∏ÊäûËÇ¢„ÅÆË°®Á§∫ ---
        function showChoices(choices) {
            if (!choices || choices.length === 0) return;
            
            setTimeout(() => {
                choicesContainer.classList.remove("hidden");
                choices.forEach(choice => {
                    const button = document.createElement("button");
                    button.innerText = choice.text;
                    button.className = "choice-btn";
                    button.onclick = (e) => {
                        e.stopPropagation();
                        loadScene(choice.next);
                    };
                    choicesContainer.appendChild(button);
                });
            }, 200);
        }
    </script>
</body>
</html>